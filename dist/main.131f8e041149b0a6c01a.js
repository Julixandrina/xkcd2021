(()=>{"use strict";async function t(t=null){let e="";t&&(e=`/${t}`);const n=`https://xkcd.com${e}/info.0.json`;let r=await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(n)}`);if(r.ok){const t=await r.json();return JSON.parse(t.contents)}throw new Error(`HTTP error! status: ${r.status}`)}document.addEventListener("DOMContentLoaded",(function(){e.init()}));let e={currentEntry:{title:"",safe_title:"",img:"",alt:"",transcript:"",day:"",month:"",year:""},lastEntry:{},$:{mainBlockContent:document.querySelector(".main-content"),blockLoader:document.querySelector(".preloader"),comicsBlockView:document.querySelector(".comics-block-view"),titleEntry:document.getElementById("entry-title"),imageEntry:document.getElementById("entry-image"),dateInfo:document.getElementById("entry-date"),transcriptEntry:document.getElementById("entry-transcript"),btnStart:document.getElementById("btn-start"),btnEnd:document.getElementById("btn-end"),btnPrev:document.getElementById("btn-prev"),btnNext:document.getElementById("btn-next"),btnRandom:document.getElementById("btn-random"),btnShare:document.getElementById("btn-share")},onAfterImageEntryLoaded(){this.hidePreload(),this.btnsAutoState()},bindEvents:function(){this.$.btnNext.addEventListener("click",(()=>{this.showNextEntry()})),this.$.btnPrev.addEventListener("click",(()=>{this.showPrevEntry()})),this.$.btnStart.addEventListener("click",(()=>{this.showFirstEntry()})),this.$.btnEnd.addEventListener("click",(()=>{this.showLastEntry()})),this.$.btnRandom.addEventListener("click",(()=>{this.showRandomEntry()})),this.$.imageEntry.addEventListener("load",(()=>{this.onAfterImageEntryLoaded()})),this.$.btnShare.addEventListener("click",(()=>{this.shareLinkEntry()})),window.addEventListener("popstate",(t=>{this.toggleEntry(t.state.numEntry,!1)}),!1)},init(){this.bindEvents(),this.showPreload(),this.loadLastEntryInfo().then((t=>{let e=this.detectEntryNumByPathname();!1!==e?this.toggleEntry(e):(this.currentEntry=t,this.drawCurrentEntry())}))},detectEntryNumByPathname(){let t=window.location.pathname.replaceAll("/","");return t.length>0&&t},loadLastEntryInfo(){return new Promise(((e,n)=>{t().then((t=>{this.lastEntry=t,e(t)})).catch(n)}))},showNextEntry(){this.toggleEntry(this.currentEntry.num+1)},showPrevEntry(){this.toggleEntry(this.currentEntry.num-1)},showFirstEntry(){this.toggleEntry(1)},showLastEntry(){this.toggleEntry()},showRandomEntry(){const t=this.lastEntry.num,e=Math.floor(Math.random()*(t-1+1))+1;this.toggleEntry(e)},shareLinkEntry(){try{navigator.share({title:document.title,text:"I like this comic",url:window.location.href})}catch(t){alert("Your browser not supports Web Share API")}},toggleEntry(e=null,n=!0){this.showPreload(),t(e).then((t=>{this.currentEntry=t,e?n&&history.pushState({numEntry:e},this.currentEntry.safe_title,`/${this.currentEntry.num}/`):history.replaceState({numEntry:e},this.currentEntry.safe_title,`/${this.currentEntry.num}/`),this.drawCurrentEntry()})).catch((t=>console.error(t)))},drawCurrentEntry(){let{title:t,safe_title:e,img:n,alt:r,transcript:i,day:s,month:a,year:o}=this.currentEntry;this.$.titleEntry.innerHTML=t,document.title=e,this.$.imageEntry.src=n,this.$.imageEntry.alt=r,this.$.dateInfo.innerHTML=new Date(o,a,s).toLocaleDateString(),this.$.transcriptEntry.innerHTML=i.replaceAll("\n","<br>")},showPreload(){this.$.mainBlockContent.classList.add("loading")},hidePreload(){this.$.mainBlockContent.classList.remove("loading")},btnsAutoState(){this.currentEntry.num===this.lastEntry.num?(this.$.btnNext.setAttribute("disabled","disabled"),this.$.btnEnd.setAttribute("disabled","disabled")):(this.$.btnNext.removeAttribute("disabled"),this.$.btnEnd.removeAttribute("disabled")),1===this.currentEntry.num?(this.$.btnPrev.setAttribute("disabled","disabled"),this.$.btnStart.setAttribute("disabled","disabled")):(this.$.btnPrev.removeAttribute("disabled"),this.$.btnStart.removeAttribute("disabled"))}}})();